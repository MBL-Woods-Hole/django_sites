{% extends "submission/base.html" %}

{% block some_content %}

  <div class="grid_5">&nbsp;</div>
  <div class="grid_4">
    {% block select_project_and_user %}{% include 'submission/select_project_and_user.html' %}{% endblock %}
  </div>
  <div class="grid_3"></div>
  <div class="clear"></div>

 {% if errors_size > 0 %} 
  {% block errors %}
    <div class="red_message">
     Please correct the error{{ errors|pluralize }} below.
     {% for err in errors %}
      <p class="notes">
       {{ err|safe }}
      </p>
     {% endfor %}
    </div>
   {% endblock %}
 {% endif %}

 {% if metadata_run_info_form %}
   {% block upload_metadata_run_info_form %}

    <div class="grid_12 form">
     <fieldset id="run_info_form_run_info">
     <legend id="run_info_form_run_info-legend">Run info</legend>

      <form action="" method="post">
       <table class="normal_table">
        {{ metadata_run_info_form.as_table }}
       </table>
        {% csrf_token %}
        <input type="submit" name="submit_run_info" value="Submit Run Info">
      </form>
     </fieldset>
     </div>
     <div class="grid_5"></div>
     <div class="clear"></div>
   {% endblock %}
  {% endif %}

  {% if metadata_out_csv_form %}
    {% block upload_metadata_out_csv_form %}
    {{ metadata_out_csv_form.management_form }}

    <!-- http://www.djangosnippets.org/snippets/1442/
    http://stackoverflow.com/questions/2233929/horizontal-per-row-forms-in-a-django-formset
      TODO: send out_metadata_table ad dict to metadata_out_csv_form! then print here
       -->

      <div class="grid_12 form">
       <fieldset id="submission_metadata_form_submission_metadata">
       <legend id="submission_metadata_form_submission_metadata-legend">Submission metadata</legend>

        <!-- {{ csv_by_header_uniqued }} -->
        <form action="" method="post">
         <table class="normal_table_w_borders">
          <tr>
          {% for header in out_metadata_table.headers %}
              <th>{{ header }}</th>
          {% endfor %}
          </tr>

        {% for form in metadata_out_csv_form %}        
          <tr>
            {% for field in form %}
              <td>{% if field.errors %}{{ field.errors }}{% endif %}{{ field }}</td>
            {% endfor %}
          </tr>
        {% endfor %}

         </table>
          {% csrf_token %}
          <input type="submit" name="create_submission_metadata_file" value="Create submission metadata file">
          <!-- cancel button! -->
        </form>
       </fieldset>
       </div>
       <div class="clear"></div>

       <div class="grid_12">
        {% if files_created %}
          {% for file_path in files_created %}
            <p class=green_message>{{ file_path }} was created</p>
          {% endfor %}

        {% endif %}
       </div>
       <div class="clear"></div>

   {% endblock %}
  {% endif %}

{% endblock %}
